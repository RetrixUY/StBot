@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap");

/* Escala 100% del viewport de la Browser Source */
:root{
  --neon-rgb: 168,85,247;

  /* espaciados (basados en ancho para que 800×200 no quede minúsculo) */
  --pad:    clamp(10px, 1.5vw, 24px);
  --gap:    clamp(8px,  1.2vw, 18px);
  --radius: clamp(10px, 1.2vw, 20px);

  /* tipografías (escalan con el ancho) */
  --fs-title:   clamp(16px, 2.2vw, 34px);
  --fs-art:     clamp(12px, 1.6vw, 22px);
  --fs-times:   clamp(11px, 1.4vw, 18px);

  /* barra (mínimos para alturas chicas) */
  --bar-h: clamp(8px, 0.9vh, 14px);

  /* tamaño de carátula: limitado por alto y por ancho para no desbalancear */
  /* - a 800×200 → ~150px */
  --cover: min(
    calc((100vh - (var(--pad) * 2)) * 0.78),
    calc((100vw - (var(--pad) * 2)) * 0.22)
  );
}

html,body{
  margin:0; background:transparent; height:100%;
  color:#fff; font-family:"Roboto",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  -webkit-font-smoothing:antialiased;
}

/* ===== El widget ocupa todo el Browser Source ===== */
.nowplaying{
  position: fixed; inset: 0;
  width: 100vw; height: 100vh;
  display: flex; align-items: center;
  gap: var(--gap); padding: var(--pad);
  box-sizing: border-box; border-radius: var(--radius);

  background:
    linear-gradient(to bottom, rgba(255,255,255,.28), rgba(255,255,255,.28)),
    radial-gradient(rgba(0,0,0,.05) 1px, transparent 1px),
    rgba(26, 0, 39, .18);
  background-size: auto, .18vh .18vh, auto;
  background-blend-mode: normal, overlay, screen;

  backdrop-filter: blur(.7vh) saturate(130%) brightness(110%);
  -webkit-backdrop-filter: blur(.7vh) saturate(130%) brightness(110%);

  border: 1px solid rgba(233,213,255,.35);
  box-shadow:
    0 0 1.5vh rgba(var(--neon-rgb), .55),
    0 0 3.8vh rgba(var(--neon-rgb), .35),
    0 .6vh 1.8vh rgba(0,0,0,.26),
    inset 0 0 0 1px rgba(255,255,255,.25);

  overflow: hidden;
  opacity: 0; transform: translateY(140%);
  transition: transform 260ms cubic-bezier(.2,.8,.2,1), opacity 200ms ease;
}
.nowplaying.np-active{ opacity:1; transform: translateY(0); }

/* ===== Carátula cuadrada a la izquierda ===== */
.nowplaying img{
  width: var(--cover); height: var(--cover);
  aspect-ratio: 1/1; object-fit: cover; flex: 0 0 auto;
  border-radius: calc(var(--radius)*.66);
  box-shadow: 0 .2vh .6vh rgba(0,0,0,.22), 0 0 .9vh rgba(var(--neon-rgb), .30);
  border: 1px solid rgba(233,213,255,.25);
}

/* ===== Columna de info compacta (sin “hueco” intermedio) ===== */
.meta{
  display: grid;
  grid-auto-rows: auto;           /* cada bloque ocupa lo que necesita */
  align-content: center;           /* centra todo verticalmente */
  gap: calc(var(--gap) * .55);
  width: 100%; overflow: hidden;
}

.title, .artists, .times{
  color:#fff;
  text-shadow:
    0 0 .4vh rgba(var(--neon-rgb), .65),
    0 0 1.4vh rgba(var(--neon-rgb), .45),
    0 .12vh .36vh rgba(0,0,0,.55);
}

.title{
  font-weight: 900;
  font-size: var(--fs-title);
  line-height: 1.1;
  white-space: nowrap; overflow: hidden;
}
.artists{
  font-weight: 700;
  font-size: var(--fs-art);
  line-height: 1.14;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  opacity: .98;
}

/* Progreso pegado al bloque, no al fondo */
.progress{
  display: grid;
  grid-template-rows: var(--bar-h) auto;
  row-gap: calc(var(--gap) * .35);
}

.bar{
  width: 100%; height: var(--bar-h);
  background: rgba(255,255,255,.22);
  border-radius: 999px; overflow: hidden;
  border: 1px solid rgba(233,213,255,.35);
  box-shadow:
    inset 0 0 .4vh rgba(var(--neon-rgb), .35),
    inset 0 0 1.4vh rgba(var(--neon-rgb), .25);
}
.bar__fill{
  height: 100%; width: 0%;
  background:
    radial-gradient(closest-side, rgba(233,213,255,1) 40%, rgba(233,213,255,0) 70%) center/.36vh 100% no-repeat,
    linear-gradient(90deg, rgba(233,213,255,1), rgba(192,132,252,1), rgba(168,85,247,1));
  filter:
    drop-shadow(0 0 .75vh rgba(var(--neon-rgb), .75))
    drop-shadow(0 0 1.7vh rgba(var(--neon-rgb), .45));
  transform-origin: left center;
  animation: neon-flow 3s linear infinite;
}
@keyframes neon-flow{
  0%{ background-position: 0 0, 0 0; }
  100%{ background-position: 6vh 0, 0 0; }
}

.times{
  display:flex; justify-content:space-between;
  font-weight: 900; font-size: var(--fs-times); opacity: .98;
}

/* Marquee (igual que antes) */
.title .m-text{ display:inline-block; padding-right: var(--marquee-gap, 0px); }
.title .m-text.m-clone{ display:none; }
.title.marquee .m-text{ will-change:transform; animation: marquee linear infinite var(--marquee-duration, 12s); }
.title.marquee .m-text.m-clone{ display:inline-block; position:absolute; }
@keyframes marquee{
  0%{transform:translateX(0)}
  100%{transform:translateX(calc(-1 * (var(--marquee-content-width) + var(--marquee-gap))))}
}

/* Pulso al cambiar */
.nowplaying.pulse{ animation:pulse-neon 700ms ease-out 1; }
@keyframes pulse-neon{
  0%{ box-shadow: 0 0 1.5vh rgba(var(--neon-rgb), .55), 0 0 3.8vh rgba(var(--neon-rgb), .35); }
  40%{ box-shadow: 0 0 2.9vh rgba(var(--neon-rgb), .80), 0 0 7.6vh rgba(var(--neon-rgb), .55); }
  100%{ box-shadow: 0 0 1.5vh rgba(var(--neon-rgb), .55), 0 0 3.8vh rgba(var(--neon-rgb), .35), 0 .6vh 1.8vh rgba(0,0,0,.26); }
}
